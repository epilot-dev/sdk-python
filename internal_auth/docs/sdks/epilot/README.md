# Epilot SDK


## Overview

Internal Auth API: Auth API to provide JWT tokens for internal API access that work with the epilot custom authorizer.

Converts AWS credentials into a JWT token with caller's ARN `callerIdentity` and list of `policies` granting access to API Gateway as claims.


### Available Operations

* [get_jwks](#get_jwks) - getJwks
* [get_open_id_configuration](#get_open_id_configuration) - getOpenIDConfiguration
* [get_token](#get_token) - getToken
* [get_token_v2](#get_token_v2) - getTokenV2

## get_jwks

Get jwks public key set to verify tokens generated by this API

### Example Usage

```python
from epilot_internal_auth import Epilot

s = Epilot(
    sigv4="<YOUR_API_KEY_HERE>",
)


res = s.get_jwks()

if res is not None:
    # handle response
    pass

```

### Parameters

| Parameter                                                           | Type                                                                | Required                                                            | Description                                                         |
| ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `retries`                                                           | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)    | :heavy_minus_sign:                                                  | Configuration to override the default retry behavior of the client. |


### Response

**[models.GetJwksResponseBody](../../models/getjwksresponsebody.md)**
### Errors

| Error Object    | Status Code     | Content Type    |
| --------------- | --------------- | --------------- |
| models.SDKError | 4xx-5xx         | */*             |

## get_open_id_configuration

OpenID Connect configuration for internal auth as identity provider

Note: This API is not a fully compliant OAuth2.0 / OIDC identity provider, but this endpoint is useful to
automate the process of verifying JWT tokens.


### Example Usage

```python
from epilot_internal_auth import Epilot

s = Epilot(
    sigv4="<YOUR_API_KEY_HERE>",
)


res = s.get_open_id_configuration()

if res is not None:
    # handle response
    pass

```

### Parameters

| Parameter                                                           | Type                                                                | Required                                                            | Description                                                         |
| ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `retries`                                                           | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)    | :heavy_minus_sign:                                                  | Configuration to override the default retry behavior of the client. |


### Response

**[models.GetOpenIDConfigurationResponseBody](../../models/getopenidconfigurationresponsebody.md)**
### Errors

| Error Object    | Status Code     | Content Type    |
| --------------- | --------------- | --------------- |
| models.SDKError | 4xx-5xx         | */*             |

## get_token

Generates token for internal API access

Example JWT payload:

```json
{
  "callerIdentity": "arn:aws:sts::912468240823:assumed-role/ep_prod_access_admin/awsmfa_20210225T193753",
  "policies": [
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": "*",
          "Resource": "*"
        }
      ]
    }
  ],
  "iss": "https://internal-auth.sls.epilot.io/v1/internal-auth",
  "iat": 1614278397,
  "exp": 1614281997
}
```


### Example Usage

```python
from epilot_internal_auth import Epilot

s = Epilot(
    sigv4="<YOUR_API_KEY_HERE>",
)


res = s.get_token()

if res is not None:
    # handle response
    pass

```

### Parameters

| Parameter                                                           | Type                                                                | Required                                                            | Description                                                         |
| ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `retries`                                                           | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)    | :heavy_minus_sign:                                                  | Configuration to override the default retry behavior of the client. |


### Response

**[models.GetTokenResponseBody](../../models/gettokenresponsebody.md)**
### Errors

| Error Object    | Status Code     | Content Type    |
| --------------- | --------------- | --------------- |
| models.SDKError | 4xx-5xx         | */*             |

## get_token_v2

Generates token for internal API access with internal roles

Example JWT payload:

```json
{
  "callerIdentity": "arn:aws:sts::912468240823:assumed-role/ep_prod_access_admin/awsmfa_20210225T193753",
  "policies": [
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": "*",
          "Resource": "*"
        }
      ]
    }
  ],
  "assume_roles": ["org_id:note_role", "org_id:file_role"],
  "org_id": "org_id",
  "iss": "https://internal-auth.sls.epilot.io/v1/internal-auth",
  "iat": 1614278397,
  "exp": 1614281997
}
```


### Example Usage

```python
import epilot_internal_auth
from epilot_internal_auth import Epilot

s = Epilot(
    sigv4="<YOUR_API_KEY_HERE>",
)


res = s.get_token_v2(request=epilot_internal_auth.AuthRequest(
    assume_roles=[
        "org_id:root",
    ],
    expires=62984,
    org_id="12345",
))

if res is not None:
    # handle response
    pass

```

### Parameters

| Parameter                                                           | Type                                                                | Required                                                            | Description                                                         |
| ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------- |
| `request`                                                           | [models.AuthRequest](../../models/authrequest.md)                   | :heavy_check_mark:                                                  | The request object to use for the request.                          |
| `retries`                                                           | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)    | :heavy_minus_sign:                                                  | Configuration to override the default retry behavior of the client. |


### Response

**[models.GetTokenV2ResponseBody](../../models/gettokenv2responsebody.md)**
### Errors

| Error Object    | Status Code     | Content Type    |
| --------------- | --------------- | --------------- |
| models.SDKError | 4xx-5xx         | */*             |
